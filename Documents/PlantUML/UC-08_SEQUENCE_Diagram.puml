@startuml
title: UC-08: Make Payment - Sequence Diagram
actor PetOwner
entity "User Interface (UI)" as UI
box "App core" #LightYellow
  entity "Payment Manager" as PaymentManager
  entity "User Authentication" as UserAuth
  entity "Security Manager" as Security
  entity "Error Handler" as ErrorHandler
end box
box "API Server" #LightGreen
  entity "Payment Processing API" as PaymentAPI
  entity "User Verification API" as UserVerifyAPI
  entity "Error Logger API" as LoggerAPI
end box
database "Database" as DB

PetOwner -> UI : Selects "Make Payment" 
activate UI

UI -> UserAuth : Verifies user authentication
activate UserAuth
UserAuth --> UI : Returns authentication status
deactivate UserAuth

UI -> PaymentManager : Request to initiate payment process
activate PaymentManager

PaymentManager -> UI : Request for payment details
UI -> PetOwner : Prompt for payment details
PetOwner -> UI : Inputs payment details

UI -> Security : Encrypts payment details
activate Security
Security --> UI : Returns encrypted details
deactivate Security

UI -> PaymentManager : Sends encrypted payment details
PaymentManager -> PaymentAPI : Sends encrypted payment details
activate PaymentAPI

PaymentAPI -> UserVerifyAPI : Verifies user credentials
activate UserVerifyAPI
UserVerifyAPI -> DB : Check user credentials
activate DB
DB --> UserVerifyAPI : Returns user verification status
deactivate DB
UserVerifyAPI --> PaymentAPI : Returns user verification status
deactivate UserVerifyAPI

PaymentAPI -> DB : Stores payment details in database
DB --> PaymentAPI : Returns payment confirmation
deactivate DB

alt Successful Payment
    PaymentAPI --> PaymentManager : Returns payment confirmation
    PaymentManager --> UI : Updates payment status
    UI --> PetOwner : Displays payment confirmation
else Payment Error
    PaymentAPI -> LoggerAPI : Logs error details
    activate LoggerAPI
    LoggerAPI -> DB : Store error details
    activate DB
    DB --> LoggerAPI : Returns storage confirmation
    deactivate DB
    LoggerAPI --> PaymentAPI : Returns error log confirmation
    deactivate LoggerAPI
    PaymentAPI --> ErrorHandler : Sends error details
    activate ErrorHandler
    ErrorHandler --> UI : Updates error status
    UI --> PetOwner : Displays error message
end

deactivate PaymentAPI
deactivate ErrorHandler
deactivate PaymentManager
deactivate UI
@enduml


